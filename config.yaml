# config.yaml - WITH AUTO-SCALING
# =============================================================================
# This config uses AUTO-SCALING to maintain constant physical speeds
# regardless of upsampling factor!
# =============================================================================

# Maze file: .csv or .txt (format: 1=wall, 0=free, 2=start, 4=end)
maze_file: "mazefiles/classic/alljapan-045-2024-exp-fin.txt"

# =============================================================================
# PATH PLANNER SELECTION
# =============================================================================
# Choose which path planning algorithm to use
# Options: "astar", "theta_star", "rrt"
path_planner: "astar"

# =============================================================================
# PHYSICAL DIMENSIONS - For m/s speed conversion
# =============================================================================
physical_dimensions:
  # Standard AAMC maze: 16x16 cells, each cell is 18cm (0.18m)
  # Total maze size: 16 * 0.18 = 2.88m x 2.88m
  maze_width_meters: 2.88       # Physical width of the maze in meters
  maze_height_meters: 2.88      # Physical height of the maze in meters
  use_metric_speeds: true       # If true, speeds in config are in m/s and converted to grid units

simulation:
  window_size: 900
  fps: 60

visualization:
  figure_size: [12, 12]
  cmap_colors: ['white', 'black', 'green', 'red', 'blue']
  title: "Micromouse Simulation - Auto-Scaled Speeds"

# =============================================================================
# Wall cost parameters for A* pathfinding - always enabled, but can be tuned
# =============================================================================

wall_cost:
  enabled: true
  weight: 4.0   # Higher weight = stronger avoidance of walls (but may lead to longer paths)
  decay: "exponential"  # "linear" or "exponential"
  decay_rate: 0.5  # For exponential decay, higher = faster decay of wall cost with distance
  threshold: 5.0  # Maximum distance (in grid units) at which wall cost is applied

# =============================================================================
# A* PATHFINDING PARAMETERS
# =============================================================================

astar:
  debug: false            # Set true to see A* visualization
  visualize_every: 50
  heuristic_weight: 1.0

  # Turn cost parameters for smoother paths
  turn_cost_enabled: false     # Set true to enable turn cost penalty
  turn_cost_weight: 2.0        # Weight for turn penalty
                               # Higher = smoother paths (but longer)
  turn_cost_threshold: 45      # Degrees - no penalty below this
                               # Lower = penalize even gentle curves

# =============================================================================
# THETA* PATH PLANNING PARAMETERS
# =============================================================================
# Theta* produces any-angle paths that are 5-20% shorter than A*
# See theta_star_integration.md for details

theta_star:
  resolution: 1.0              # Grid resolution (should match maze cell size)
  robot_radius: 0.3            # Obstacle inflation radius for safety
  debug: true                  # Enable debug output
  show_animation: false        # Keep false to avoid conflicts with main viz

# =============================================================================
# RRT PATH PLANNING PARAMETERS
# =============================================================================
# Rapidly-exploring Random Tree - sampling-based planning

rrt:
  max_iter: 1000               # Maximum iterations
  step_size: 0.5               # Extension step size
  goal_bias: 0.1               # Probability of sampling goal (0.0-1.0)
  goal_tolerance: 1.0          # Distance to goal considered success
  debug: true                  # Enable debug output

# =============================================================================
# MAZE UPSAMPLING WITH AUTO-SCALING
# =============================================================================
maze_upsampling:
  enabled: false
  factor: 1                     # 4x resolution for fine path planning
  auto_scale_speeds: true       # ENABLE AUTO-SCALING!

# =============================================================================
# Pure Pursuit parameters - speeds are in m/s if use_metric_speeds is true, otherwise in grid units/sec
# fine tune these parameters to achieve smooth and efficient path following
# =============================================================================

pure_pursuit:
  # When physical_dimensions.use_metric_speeds = true, speeds are in m/s
  # Otherwise speeds are in grid units/sec
  lookahead_distance: 3.0       # in grid units
  max_speed: 0.1               # max allowed speed = 4 m/s 
  min_speed: 0.001               # m/s
  steering_gain: 1.0     # Gain for steering control (higher = more aggressive)
  slow_steering_threshold: 1.0     # Degrees - start slowing down steering below this angle
  debug: true                   # Enable to see path following
  visualize_every: 5        # Visualize every N steps (set to 1 for continuous visualization)


# =============================================================================
# Configure the micromouse orientation, timestep, and goal threshold - don't modify
# 
# =============================================================================

micromouse:
  initial_heading: 3.14257      # π = 180 degrees (facing up)
  dt: 0.01667                   # timestep in seconds (1/60 for real-time at 60 FPS)
  goal_threshold: 1.0           # in grid units
  min_speed_threshold: 0.001    # m/s (when use_metric_speeds: true)
  debug: true                   # Enable debug visualization
  visualize_every: 5

# =============================================================================
# DIFFERENTIAL DRIVE WITH SPIN-OUT PHYSICS
# =============================================================================
diff_drive:
  # Physical dimensions
  wheel_radius: 0.02 # don't modify
  wheelbase: 0.06 # don't modify
  
  # Motor constraints (base values, will be scaled)
  max_wheel_speed: 50.0         #  limit: 200 rad/s 
  max_acceleration: 20.0        # limit: 400 rad/s²
  
  # ==========================================================================
  # SPIN-OUT PARAMETERS - don't modify
  # ==========================================================================
  base_slip_factor: 0.995       # Excellent base grip
  velocity_slip_factor: 0.001    # Minimal velocity-induced slip
  turn_rate_slip_factor: 0.001   # Minimal turn-induced slip
  combined_slip_factor: 0.001    # Key parameter - much more forgiving
  max_slip: 0.01                # Low maximum slip
  
  spinout_threshold: 0.97       # Much harder to trigger spinout
  spinout_angular_boost: 1.0    # Mild angular boost
  spinout_linear_reduction: 0.75 # Retain substantial linear velocity
  recovery_threshold: 0.95      # Easy recovery
  spinout_noise: 0.001           # Minimal chaotic behavior
  
  # ==========================================================================
  # PHYSICS MODEL - don't modify
  # ==========================================================================
  use_lateral_accel_model: true
  robot_mass: 0.15
  coefficient_friction: 0.95    # High traction surface
  gravity: 9.81
  lateral_accel_threshold: 0.95 # Very high threshold
  velocity_noise: 0.005         # Minimal noise